<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="style/dash.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function() {
            $("#header").load("/components/header.html");
        });
    </script>
</head>

<body>
  <div id="header"></div>

  <div class="container">
    <div class="row mt-4">
      <div class="col">
        <a href="/admin/addevent" class="btn btn-primary btn-block">Add new Event</a>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col">
        <a href="/admin/userDisplay" class="btn btn-primary btn-block">Display all Users</a>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col">
        <a href="/admin/adduser" class="btn btn-primary btn-block">Add new User</a>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col">
        <a href="/admin/addAdmin" class="btn btn-primary btn-block">Add new Admin</a>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col">
        <a href="/admin/eventDisplay" class="btn btn-primary btn-block">Display all events</a>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col">
        <a href="/admin/campDetails" class="btn btn-primary btn-block">Add camp Record</a>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col">
        <a href="/admin/showCampDetails" class="btn btn-primary btn-block">Show camp Record</a>
      </div>
    </div>
  </div>
  <h3>Users</h3>
<div style="display: flex;justify-content: space-around;">
  <canvas id="pieChart"></canvas>
  <canvas id="branchPieChart"></canvas>
  <canvas id="batchBarChart"></canvas>


</div>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
<script>
// import Chart from 'chart.mjs';
fetch('/admin/users')
  .then(response => response.json())
  .then(users => {
    const maleCount = users.filter(user => user.gender === 'male').length;
    const femaleCount = users.filter(user => user.gender === 'female').length;
    const pieChartCanvas = document.getElementById('pieChart').getContext('2d');
    const pieChart = new Chart(pieChartCanvas, {
      type: 'pie',
      data: {
        labels: ['Male', 'Female'],
        datasets: [{
          data: [maleCount, femaleCount],
          backgroundColor: ['#FF6384', '#36A2EB'],
        }],
      },
      options: {
        responsive: false,
        width: 300,
        height: 300,
      },
    });

    const branchCounts = users.reduce((counts, users) => {
      counts[users.branch] = (counts[users.branch] || 0) + 1;
      return counts;
    }, {});

    // Extract branch labels and counts
    const branchLabels = Object.keys(branchCounts);
    const branchData = Object.values(branchCounts);

    // Create the pie chart
    const pieChartBranch = document.getElementById('branchPieChart').getContext('2d');
    const branchPieChart = new Chart(pieChartBranch, {
      type: 'pie',
      data: {
        labels: branchLabels,
        datasets: [{
          data: branchData,
          backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#E7E9ED'],
        }],
      },
      options: {
        responsive: false,
        width: 300,
        height: 300,
      },
    });
    const batchCounts = users.reduce((counts, user) => {
      counts[user.batch] = (counts[user.batch] || 0) + 1;
      return counts;
    }, {});

    // Extract batch labels and counts
    const batchLabels = Object.keys(batchCounts);
    const batchData = Object.values(batchCounts);

    // Create the bar chart
    const barChartCanvas = document.getElementById('batchBarChart').getContext('2d');
    const batchBarChart = new Chart(barChartCanvas, {
      type: 'bar',
      data: {
        labels: batchLabels,
        datasets: [{
          label: 'Number of Users',
          data: batchData,
          backgroundColor: '#4BC0C0',
        }],
      },
      options: {
        responsive: false,
        width: 300,
        height: 300,
        scales: {
          y: {
            beginAtZero: true,
            precision: 0,
          },
        },
      },
    });
  })
  .catch(error => {
    console.error('Error fetching user data:', error);
  });

</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</html>